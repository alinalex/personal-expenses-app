## Personal Expenses Project

This project was born from my need to have all my personal credit card expenses in one place and to customise the experience the way I see fit by my needs.

## How to run the project

You need to create an .env.local file in the root of the project with the following variables:
- NEXT_PUBLIC_SUPABASE_URL=''
- NEXT_PUBLIC_SUPABASE_ANON_KEY=''
- NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=''
- CLERK_SECRET_KEY=''
- CARDLESS_SECRET_KEY=''
- CARDLESS_SECRET_ID=''
- NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
- NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
- NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard/admin
- NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard/admin
- NEXT_PUBLIC_BANK_OAUTH_REDIRECT=''

You have to create an account with [clerk](https://clerk.com/), [supabase](https://supabase.com/) and [gocardless](https://gocardless.com/developers/) from where you'll get the first six variables that I left empty string.

Also, I used [axiom](https://axiom.co/) for logging, so you should also create an account to have all the logging in the same place.

## Database tables definition

**access_tokens**
```
create table
  public.access_tokens (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    access_token text null,
    refresh_token text null,
    constraint access_tokens_pkey primary key (id)
  ) tablespace pg_default;
```

**account_transactions**
```
create table
  public.account_transactions (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    account_id bigint null,
    booking_date date null,
    amount numeric null,
    currency text null,
    internal_transaction_id text null,
    category_id bigint null,
    transaction_info text null,
    transaction_type text null,
    constraint account_transactions_pkey primary key (id),
    constraint public_account_transactions_account_id_fkey foreign key (account_id) references bank_accounts (id) on delete cascade,
    constraint public_account_transactions_category_id_fkey foreign key (category_id) references transaction_categories (id)
  ) tablespace pg_default;

create index if not exists idx_transactions_date on public.account_transactions using btree (booking_date) tablespace pg_default;
```

**bank_accounts**
```
create table
  public.bank_accounts (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    bank_connection_id bigint null,
    account_id text null,
    iban text null,
    "isCron" boolean null default false,
    constraint bank_accounts_pkey1 primary key (id),
    constraint public_bank_accounts_bank_connection_id_fkey foreign key (bank_connection_id) references bank_connections (id) on delete cascade
  ) tablespace pg_default;
```

**bank_connections**
```
create table
  public.bank_connections (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    user_id text null,
    bank_id text null,
    country_code text null,
    requisition_id text null,
    bank_name text null,
    oauth_link text null,
    bank_logo text null,
    "isDone" boolean null,
    constraint bank_accounts_pkey primary key (id)
  ) tablespace pg_default;
```

**category_rules**
```
create table
  public.category_rules (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    category_id bigint null,
    is_positive boolean null,
    transaction_type text null,
    includes text null,
    not_includes text null,
    bigger_than numeric null,
    smaller_than numeric null,
    constraint category_rules_pkey primary key (id),
    constraint public_category_rules_category_id_fkey foreign key (category_id) references transaction_categories (id)
  ) tablespace pg_default;
```

**expenses_totals**
```
create table
  public.expenses_totals (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    account_id bigint null,
    year_month text null,
    inner text null,
    outer text null,
    total text null,
    constraint expenses_totals_pkey primary key (id),
    constraint public_expenses_totals_account_id_fkey foreign key (account_id) references bank_accounts (id)
  ) tablespace pg_default;
```

**transaction_categories**
```
create table
  public.transaction_categories (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    category_name text null,
    constraint transaction_categories_pkey primary key (id)
  ) tablespace pg_default;
```